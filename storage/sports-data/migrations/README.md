# Database Migrations

This directory contains SQL migration files generated by Drizzle Kit during development.

## How It Works

Since each client (web browser, iOS app, Android app) has its own local SQLite database, we use a **fully automatic runtime migration system**:

1. **Development**: Make schema changes, then run `npm run db:generate`
2. **Automatic**: The script generates SQL files AND creates the migrations index
3. **Runtime**: When the app starts, `setupDatabase()` automatically runs all migrations

## Workflow

1. **Make schema changes** in `storage/sports-data/schema/tables/`

2. **Generate migrations (automatic):**
   ```bash
   npm run db:generate
   ```
   This automatically:
   - Generates SQL files in this directory
   - Creates `storage/sports-data/schema/migrations/index.ts` with embedded SQL
   - No manual steps required!

3. **Runtime**: The app automatically runs migrations when it starts via `setupDatabase()`

## Migration Files

Migration files are named with a timestamp and description, e.g.:
- `0000_initial_schema.sql`
- `0001_add_new_table.sql`

These are generated files - don't edit them directly. Edit the schema files instead, then regenerate.

## How Migrations Run

1. App starts and calls `setupDatabase(db)`
2. `setup.ts` imports migrations from `migrations/index.ts`
3. Checks which migrations have already been applied (tracked in `__drizzle_migrations` table)
4. Runs any new migrations in order
5. Records applied migrations to prevent re-running

Everything is **fully automatic** - no manual copying or editing required!

